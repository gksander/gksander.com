---
// import "@fontsource-variable/jetbrains-mono";
import { TableOfContents } from "@components/posts/TableOfContents";
import { getCollection, type CollectionEntry } from "astro:content";
import clsx from "clsx";
import Layout from "src/layouts/Layout.astro";
import "@styles/blogpost.pcss";
import { Header } from "@components/Header";
import { ContentContainer } from "@components/ContentContainer";
import { format } from "date-fns/format";

export async function getStaticPaths() {
  const posts = await getCollection("post");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { ...post },
  }));
}
type Props = CollectionEntry<"post">;

const post = Astro.props;
const { Content, headings } = await post.render();

const isLongform = post.data.style === "longform";
const formattedPubDate = format(post.data.pubDate, "MMMM d, yyyy");

const PROSE_CLASSES = [
  "max-w-none prose",
  "prose-code:before:hidden prose-code:after:hidden prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:bg-background-dark prose-code:font-medium",
  "hover:prose-a:text-primary-700 dark:hover:prose-a:text-primary-300",
];
---

<Layout
  title={`${post.data.title} | Grant Sander`}
  description={post.data.metaDescription || post.data.description}
  isFat={isLongform}
  hasKatex={post.data.hasMath}
  keywords={post.data.keywords}
>
  <Header isFat={isLongform} />

  {
    isLongform ? (
      <ContentContainer
        className="py-12 grid grid-cols-1 lg:grid-cols-[1fr,300px] gap-x-12 gap-y-12"
        isFat={true}
      >
        <main>
          <div class="font-medium text-subtle-copy">{formattedPubDate}</div>
          <h1 class="mb-12 text-3xl font-bold">{post.data.title}</h1>

          <div class:list={PROSE_CLASSES}>
            <Content />
          </div>
        </main>
        {/* <div class="container max-w-content p-6 pt-12 flex flex-col gap-y-16">
          <main class="flex-grow overflow-hidden col-start-1">
            <div
              class={clsx(
                "max-w-none prose",
                "prose-code:before:hidden prose-code:after:hidden prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:font-medium",
                "hover:prose-a:text-primary-700 dark:hover:prose-a:text-primary-300"
              )}
            >
              <Content />
            </div>
          </main> */}

        <TableOfContents headings={headings} client:visible />
        {/* </div> */}
      </ContentContainer>
    ) : (
      <ContentContainer>Hey</ContentContainer>
    )
  }

  <!-- <main class="container max-w-content p-6 pt-12 flex flex-col gap-y-16">
    <div class="flex-grow overflow-hidden col-start-1">
      <div
        class={clsx(
          "max-w-none prose",
          "prose-code:before:hidden prose-code:after:hidden prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:font-medium",
          "hover:prose-a:text-primary-700 dark:hover:prose-a:text-primary-300"
        )}
      >
        <Content />
      </div>
    </div>

    <TableOfContents headings={headings} client:visible />
  </main> -->
</Layout>
